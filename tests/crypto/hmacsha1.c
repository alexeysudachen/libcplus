
#include "../../c+/program.hc"
#include "../../c+/tester.hc"
#include "../../c+/crypto/sha1.hc"

struct SHA1_VECTOR
{
	const char *key;
	int key_filler;
	int key_len;
	const char *input;
	int input_filler;
	int input_len;
	byte_t result[20];
} g_vec[] = {

	{ 0, 0x0B, 20,
	"Hi There", 0, 8,
	{ 0xB6, 0x17, 0x31, 0x86, 0x55, 0x05, 0x72, 0x64, 0xE2, 0x8B,
	0xC0, 0xB6, 0xFB, 0x37, 0x8C, 0x8E, 0xF1, 0x46, 0xBE, 0x00 }},

	{ "Jefe", 0, 4,
	"what do ya want for nothing?", 0, 28,
	{ 0xEF, 0xFC, 0xDF, 0x6A, 0xE5, 0xEB, 0x2F, 0xA2, 0xD2, 0x74,
	0x16, 0xD5, 0xF1, 0x84, 0xDF, 0x9C, 0x25, 0x9A, 0x7C, 0x79 }},

	{ 0, 0xAA, 20, 
	0, 0xDD, 50,
	{ 0x12, 0x5D, 0x73, 0x42, 0xB9, 0xAC, 0x11, 0xCD, 0x91, 0xA3,
	0x9A, 0xF4, 0x8A, 0xA1, 0x7B, 0x4F, 0x63, 0xF1, 0x75, 0xD3 }},

	{ "\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19", 0, 25,
	0, 0xCD, 50,
	{ 0x4C, 0x90, 0x07, 0xF4, 0x02, 0x62, 0x50, 0xC6, 0xBC, 0x84,
	0x14, 0xF9, 0xBF, 0x50, 0xC8, 0x6C, 0x2D, 0x72, 0x35, 0xDA }},

	{ 0, 0xAA, 80,
	"Test Using Larger Than Block-Size Key - Hash Key First", 0, 54,
	{ 0xAA, 0x4A, 0xE5, 0xE1, 0x52, 0x72, 0xD0, 0x0E, 0x95, 0x70,
	0x56, 0x37, 0xCE, 0x8A, 0x3B, 0x55, 0xED, 0x40, 0x21, 0x12 }},

	{ 0, 0xAA, 80,
	"Test Using Larger Than Block-Size Key and Larger Than One Block-Size Data", 0, 73,
	{ 0xE8, 0xE9, 0x9D, 0x0F, 0x45, 0x23, 0x7D, 0x78, 0x6D, 0x6B,
	0xBA, 0xA7, 0x96, 0x5C, 0x78, 0x08, 0xBB, 0xFF, 0x1A, 0x91 }}
};

void Test_N(int no)
{
	C_HMAC_SHA1 ctx;
	byte_t digest[20];
	byte_t *buf;

	Do_Test_Case(__Format("SHA1-#%d VECTOR",no))
	{
		if ( !g_vec[no].key )
		{
			buf = __Malloc(g_vec[no].key_len);
			memset(buf, g_vec[no].key_filler, g_vec[no].key_len);
			Hmac_Sha1_Start(&ctx,buf,g_vec[no].key_len);
		}
		else
			Hmac_Sha1_Start(&ctx,g_vec[no].key,g_vec[no].key_len);

		if ( !g_vec[no].input )
		{
			buf = __Malloc(g_vec[no].input_len);
			memset(buf, g_vec[no].input_filler, g_vec[no].input_len);
			Hmac_Sha1_Update(&ctx,buf,g_vec[no].input_len);
		}
		else
			Hmac_Sha1_Update(&ctx,g_vec[no].input,g_vec[no].input_len);

		Hmac_Sha1_Finish(&ctx,digest);

		Test_Mem_Equal( g_vec[no].result, digest, 20 );
	}
}


int main(int argc, char **argv)
{
	int i;

	Prog_Init(argc,argv,0,0);	

	Do_Test_Group("crypto/hmacsha1.hc")
	{
		for ( i = 0; i < __Length_Of(g_vec); ++i )
			Test_N(i);      
	}

	return 0;
}

